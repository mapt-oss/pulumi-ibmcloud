# GitHub Actions Workflows - Simplified Configuration

## Overview

This repository uses a simplified GitHub Actions setup that:
- ✅ **Builds provider binaries** for multiple platforms (Linux, macOS, Windows on AMD64 & ARM64)
- ✅ **Creates GitHub releases** with attached binaries
- ✅ **Keeps Go SDK in the repository** (no external publishing)
- ❌ **No secrets management** (no ESC, no tokens)
- ❌ **No external registry publishing** (no NPM, PyPI, NuGet)
- ❌ **No CDN uploads**

## Active Workflows

### 1. Simple Build (`.github/workflows/simple-build.yml`)
**Triggers**: Push to main, Pull requests
**Purpose**: Continuous integration - build and test the provider
**Jobs**:
- Build provider binaries (tfgen + resource provider)
- Lint Go code
- Run tests

### 2. Simple Release (`.github/workflows/simple-release.yml`)
**Triggers**: Git tags matching `v*.*.*` or manual workflow dispatch
**Purpose**: Create GitHub releases with provider binaries
**Jobs**:
- Build provider binaries for all platforms:
  - `linux-amd64`, `linux-arm64`
  - `darwin-amd64`, `darwin-arm64`
  - `windows-amd64`, `windows-arm64`
- Package binaries as `.tar.gz` (Linux/macOS) or `.zip` (Windows)
- Calculate SHA256 checksums
- Create GitHub release with all artifacts

**No secrets required** - uses only `GITHUB_TOKEN` (automatically provided)

## Autogenerated Workflows (Disabled)

The following workflows are autogenerated by `pulumi/ci-mgmt` but are **NOT NEEDED** for this simplified setup:

### Can be ignored/deleted:
- `main.yml` - Complex main workflow with ESC secrets and publishing
- `prerelease.yml` - Prerelease workflow with publishing
- `release.yml` - Full release workflow with multi-registry publishing
- `publish.yml` - Publishes to NPM, PyPI, NuGet, and Go SDK repo
- `verify-release.yml` - Verifies published packages (not needed)
- `main-post-build.yml` - Post-build tasks for publishing

### Useful to keep:
- `build_provider.yml` - Referenced by autogenerated workflows (harmless to keep)
- `build_sdk.yml` - Referenced by autogenerated workflows (harmless to keep)
- `lint.yml` - Linting (but duplicated in `simple-build.yml`)
- `license.yml` - License checking (optional)
- `test.yml` - Testing (but duplicated in `simple-build.yml`)
- `pull-request.yml` - Comments on community PRs (optional, harmless)
- `run-acceptance-tests.yml` - Manual acceptance tests (optional)

### Maintenance workflows (keep if useful):
- `upgrade-bridge.yml` - Automated PRs to upgrade Pulumi bridge
- `upgrade-provider.yml` - Automated PRs to upgrade upstream provider
- `resync-build.yml` - Resync build configuration

## Configuration

### `.ci-mgmt.yaml`
Updated to disable publishing and secrets:
```yaml
languages:
    - go  # Only Go SDK in repo
publish:
    sdk: "none"  # Don't publish SDKs to registries
    cdn: false   # Don't upload to CDN
esc:
    enabled: false  # No secrets management
```

## Release Process

### Creating a Release

#### Option 1: Git Tag (Automatic)
```bash
git tag v1.0.0
git push origin v1.0.0
```

This will automatically:
1. Build binaries for all platforms
2. Create a GitHub release
3. Attach binaries and checksums

#### Option 2: Manual Workflow Dispatch
1. Go to Actions → Simple Release
2. Click "Run workflow"
3. Enter version (e.g., `v1.0.0`)
4. Click "Run workflow"

### Release Artifacts

Each release includes:
- `pulumi-resource-ibmcloud-v{VERSION}-linux-amd64.tar.gz`
- `pulumi-resource-ibmcloud-v{VERSION}-linux-arm64.tar.gz`
- `pulumi-resource-ibmcloud-v{VERSION}-darwin-amd64.tar.gz`
- `pulumi-resource-ibmcloud-v{VERSION}-darwin-arm64.tar.gz`
- `pulumi-resource-ibmcloud-v{VERSION}-windows-amd64.zip`
- `pulumi-resource-ibmcloud-v{VERSION}-windows-arm64.zip`
- `checksums.txt` - SHA256 checksums for verification

## Using Released Binaries

### Installation

1. Download the appropriate binary for your platform from the [Releases page](https://github.com/mapt-oss/pulumi-ibmcloud/releases)

2. Extract the archive:
   ```bash
   # Linux/macOS
   tar xzf pulumi-resource-ibmcloud-v{VERSION}-{OS}-{ARCH}.tar.gz

   # Windows
   unzip pulumi-resource-ibmcloud-v{VERSION}-windows-{ARCH}.zip
   ```

3. Install to Pulumi plugins directory:
   ```bash
   # Linux/macOS
   mkdir -p ~/.pulumi/bin
   mv pulumi-resource-ibmcloud ~/.pulumi/bin/
   chmod +x ~/.pulumi/bin/pulumi-resource-ibmcloud

   # Windows
   move pulumi-resource-ibmcloud.exe %USERPROFILE%\.pulumi\bin\
   ```

### Verify Checksums

```bash
# Download checksums.txt from the release
sha256sum -c checksums.txt
```

## Go SDK Distribution

The Go SDK is **committed to the repository** at `sdk/go/ibmcloud/`.

Users can import it directly:
```go
import "github.com/mapt-oss/pulumi-ibmcloud/sdk/go/ibmcloud"
```

Go modules will fetch it from GitHub automatically:
```bash
go get github.com/mapt-oss/pulumi-ibmcloud/sdk/go/ibmcloud
```

## TypeScript and Python SDKs

TypeScript and Python SDKs are **generated but not published**:
- Located in `sdk/nodejs/` and `sdk/python/`
- Users can use them via local installation
- Not published to NPM or PyPI

### Local Installation

#### TypeScript/Node.js
```bash
cd sdk/nodejs
npm install
npm run build
npm link

# In your project
npm link @pulumi/ibmcloud
```

#### Python
```bash
cd sdk/python
pip install -e .

# Or in your project
pip install /path/to/pulumi-ibmcloud/sdk/python
```

## Cleaning Up Old Workflows

If you want to remove the autogenerated workflows that are no longer needed:

```bash
# Remove publishing-related workflows
rm .github/workflows/main.yml
rm .github/workflows/prerelease.yml
rm .github/workflows/release.yml
rm .github/workflows/publish.yml
rm .github/workflows/verify-release.yml
rm .github/workflows/main-post-build.yml

# Optional: Keep or remove these based on your needs
# rm .github/workflows/build_provider.yml
# rm .github/workflows/build_sdk.yml
# rm .github/workflows/lint.yml
# rm .github/workflows/license.yml
# rm .github/workflows/test.yml
```

**Note**: These files are autogenerated and have a warning at the top:
```
WARNING: This file is autogenerated - changes will be overwritten
when regenerated by https://github.com/pulumi/ci-mgmt
```

Since you've disabled ESC and publishing in `.ci-mgmt.yaml`, these workflows won't work correctly anyway.

## Advantages of This Setup

1. **No Secrets Required**: Works with zero configuration
2. **Simple**: Only two workflows to maintain
3. **Self-Hosted**: Binaries on GitHub, Go SDK in repo
4. **Fast**: No external publishing delays
5. **Transparent**: Users can see exactly what's being built
6. **Flexible**: Easy to customize and extend

## Future Enhancements

If you later want to publish SDKs, you can:
1. Enable ESC in `.ci-mgmt.yaml`
2. Configure registry tokens in GitHub Secrets or ESC
3. Update `publish.sdk` in `.ci-mgmt.yaml`
4. Re-enable the autogenerated workflows

For now, the simplified setup meets your requirements perfectly.
